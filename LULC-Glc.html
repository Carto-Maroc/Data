<!DOCTYPE html>
<html lang="en" class="">
<head>
<title>CartoMaroc Provinces</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.4.0/ol.css">
<script src="https://cdn.jsdelivr.net/npm/ol@v7.4.0/dist/ol.js"></script>

<style>
  * {
    box-sizing: border-box;
  }
  
  body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    overflow-x: hidden;
  }

  #mapContainer {
    position: relative;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
  }

  /* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
  #mapTitle {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-align: center;
    padding: 15px 10px;
    font-size: clamp(16px, 4vw, 24px);
    font-weight: bold;
    border-radius: 10px 10px 0 0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  #map {
    width: 100%;
    height: 70vh;
    max-height: 600px;
    min-height: 400px;
    position: relative;
    z-index: 1;
  }

  /* ğŸ”¥ Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ© ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
  #watermark {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: clamp(18px, 5vw, 32px);
    font-weight: bold;
    color: rgba(102, 126, 234, 0.15);
    pointer-events: none;
    z-index: 1500;
    white-space: nowrap;
    text-shadow: 2px 2px 4px rgba(255,255,255,0.3);
  }

  /* Ø§Ù„Ø³Ø¹Ø± ÙˆØ²Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ */
  #bottomInfo {
    background: white;
    padding: 15px 10px;
    border-radius: 0 0 10px 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
  }

  #priceInfo {
    font-size: clamp(14px, 3vw, 18px);
    font-weight: bold;
    color: #2196F3;
    flex: 1 1 100%;
    text-align: center;
  }

  #whatsappSection {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
  }

  #provinceInput {
    padding: 10px 15px;
    border: 2px solid #25D366;
    border-radius: 25px;
    font-size: clamp(12px, 2.5vw, 14px);
    flex: 1 1 200px;
    max-width: 250px;
    outline: none;
  }

  #provinceInput:focus {
    border-color: #128C7E;
    box-shadow: 0 0 5px rgba(37, 211, 102, 0.3);
  }

  #whatsappBtn {
    background: #25D366;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    font-size: clamp(12px, 2.5vw, 16px);
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    transition: background 0.3s;
    white-space: nowrap;
  }

  #whatsappBtn:hover {
    background: #128C7E;
  }

  /* Popup Ø§Ø­ØªØ±Ø§ÙÙŠ */
  .ol-popup {
    background: linear-gradient(135deg, #ffffff 0%, #f5f7fb 100%);
    padding: 14px 16px;
    border: 1px solid #e0e4ef;
    min-width: 200px;
    max-width: 90vw;
    z-index: 9999;
    font-size: 13px;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(15, 23, 42, 0.18);
    color: #1f2933;
  }
  
  .ol-popup b {
    font-size: 14px;
    color: #111827;
  }
  
  .ol-popup a, .ol-popup button {
    display: inline-block;
    margin-top: 6px;
    padding: 6px 10px;
    background: #2563eb;
    color: #fff;
    border: none;
    border-radius: 6px;
    text-decoration: none;
    font-size: 12px;
    cursor: pointer;
    margin-right: 5px;
  }
  
  .ol-popup a:hover, .ol-popup button:hover {
    background: #1d4ed8;
  }
  
  .ol-popup .request-btn {
    background: #25D366;
  }
  
  .ol-popup .request-btn:hover {
    background: #128C7E;
  }
  
  .ol-popup .download-btn {
    background: #4CAF50;
  }
  
  .ol-popup .download-btn:hover {
    background: #388E3C;
  }

  /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« */
  #searchContainer {
    position: absolute;
    top: 70px;
    right: 10px;
    background: rgba(255, 255, 255, 0.96);
    padding: 6px 8px;
    border-radius: 999px;
    z-index: 2000;
    display: flex;
    align-items: center;
    gap: 4px;
    box-shadow: 0 8px 20px rgba(15, 23, 42, 0.18);
    border: 1px solid rgba(148, 163, 184, 0.5);
  }

  #searchBox {
    padding: 6px 12px;
    border: none;
    outline: none;
    border-radius: 999px;
    font-size: clamp(11px, 2.5vw, 13px);
    width: clamp(100px, 30vw, 160px);
    background: #f3f4f6;
    color: #111827;
  }
  
  #searchBox::placeholder {
    color: #9ca3af;
  }

  #searchBtn {
    padding: 6px 10px;
    border: none;
    background: #2563eb;
    color: white;
    border-radius: 999px;
    font-size: clamp(10px, 2vw, 12px);
    cursor: pointer;
    font-weight: 600;
    transition: background 0.2s, transform 0.1s;
  }
  
  #searchBtn:hover {
    background: #1d4ed8;
    transform: translateY(-1px);
  }

  /* ğŸ”¥ LEGEND */
  #legendBox {
    position: absolute;
    bottom: 10px;
    right: 8px;
    background: white;
    padding: 8px;
    border-radius: 8px;
    font-size: clamp(10px, 2vw, 13px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    z-index: 3000;
    width: clamp(130px, 35vw, 160px);
  }

  .legend-item {
    display: flex;
    align-items: center;
    margin-bottom: 5px;
  }

  .legend-color {
    width: 14px;
    height: 14px;
    border: 1px solid #000;
    margin-right: 6px;
    flex-shrink: 0;
  }
  
  /* Media queries Ù„Ù„Ù‡Ø§ØªÙ */
  @media (max-width: 768px) {
    #mapTitle {
      padding: 12px 8px;
    }
    
    #map {
      height: 60vh;
      min-height: 350px;
    }
    
    #searchContainer {
      top: 60px;
      right: 5px;
    }
    
    #bottomInfo {
      padding: 12px 8px;
    }
    
    #priceInfo {
      margin-bottom: 5px;
    }
    
    #legendBox {
      bottom: 8px;
      right: 5px;
      padding: 6px;
    }
  }
</style>
</head>

<body>

<div id="mapContainer">
  <div id="mapTitle">TÃ©lÃ©charger LULC GLC 30m (1985-2000-2010-2022)</div>

  <div id="map">
    <!-- ğŸ”¥ Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ© -->
    <div id="watermark">@CartoMaroc</div>
  </div>
  
  <div id="popup" class="ol-popup"></div>

  <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« -->
  <div id="searchContainer">
    <input id="searchBox" type="text" placeholder="ğŸ” Rechercher...">
    <button id="searchBtn" onclick="searchProvince()">Rechercher</button>
  </div>

  <!-- ğŸ”¥ LEGEND -->
  <div id="legendBox">
    <div class="legend-item">
      <div class="legend-color" style="background:#4CAF50;"></div> Gratuit
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background:#F44336;"></div> Payant
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background:#BDBDBD;"></div> Pas encore
    </div>
  </div>

  <!-- Ø£Ø³ÙÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
  <div id="bottomInfo">
    <div id="priceInfo">ğŸ’° Prix du service : 100 DH pour quatre annÃ©es</div>

    <div id="whatsappSection">
      <input type="text" id="provinceInput" placeholder="Nom de la province...">
      <button id="whatsappBtn" onclick="sendWhatsApp()">ğŸ“± envoyer</button>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

  /* ğŸ”¥ Ù„ÙˆØ§Ø¦Ø­ Ø§Ù„Ø£Ù‚Ø§Ù„ÙŠÙ… */
  const freeProvinces = ["Taza", "Azilal", "Safi"];  
  const paidProvinces = ["Marrakech", "Tanger-Asilah", "Skhirate-Temara"];

  const downloadLinks = {
    "Taza": "https://drive.google.com/file/d/1DBtwIGzWY2sPVm2ZAli-kBWerNMstOPw/view",
    "Azilal": "https://drive.google.com/file/d/1EXAMPLE_AZILAL/view",
    "Safi": "https://drive.google.com/file/d/1EXAMPLE_SAFI/view",
    "Marrakech": "https://drive.google.com/file/d/1DBtwIGzWY2sPVm2ZAli-kBWerNMstOPw/view",
    "Tanger-Asilah": "https://drive.google.com/file/d/1lnBOG5wqUAeG1EfuQNlenp6jHK1Pe4g_/view",
    "Skhirate-Temara": "https://drive.google.com/file/d/1Km67Ez0yEoy2zg1GKXGrjRmyRdoMKaZM/view",
  };

  const geojsonSource = new ol.source.Vector({
    url: "https://raw.githubusercontent.com/Ayoub-WebGis9/CartoMaroc/main/PROVINCE.geojson",
    format: new ol.format.GeoJSON()
  });

  function getProvinceName(feature) {
    const props = feature.getProperties();
    const possible = ["NOM-PROV","NOM_PROV","name","NAME","nom","Nom","Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…","Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…"];
    for (let f of possible) if (props[f]) return props[f];
    return "Sans nom";
  }

  /* ğŸ”¥ ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£Ù‚Ø§Ù„ÙŠÙ… */
  const geojsonLayer = new ol.layer.Vector({
  source: geojsonSource,
  style: function(feature) {
    const name = getProvinceName(feature);

    let fillColor = "rgba(162, 112, 163, 0.3"; // ØºÙŠØ± Ø¬Ø§Ù‡Ø² - Ø´ÙØ§Ù
    if (freeProvinces.includes(name)) fillColor = "rgba(76, 175, 80, 0.7)"; // Ù…Ø¬Ø§Ù†ÙŠ - Ø´ÙØ§Ù
    else if (paidProvinces.includes(name)) fillColor = "rgba(244, 67, 54, 0.7)"; // Ù…Ø¯ÙÙˆØ¹ - Ø´ÙØ§Ù

      return new ol.style.Style({
        stroke: new ol.style.Stroke({ color: "black", width: 1.3 }),
        fill: new ol.style.Fill({ color: fillColor }),
        text: new ol.style.Text({
          text: name,
          font: "bold 12px Arial",
          fill: new ol.style.Fill({ color: "#000" }),
          stroke: new ol.style.Stroke({ color: "#fff", width: 2 })
        })
      });
    }
  });

  const map = new ol.Map({
    target: "map",
    layers: [
      new ol.layer.Tile({ source: new ol.source.OSM() }),
      geojsonLayer
    ],
    view: new ol.View({
      center: ol.proj.fromLonLat([-7.9, 31.6]),
      zoom: 6
    })
  });

  const popup = new ol.Overlay({
    element: document.getElementById("popup"),
    positioning: "bottom-center",
    offset: [0, -15]
  });
  map.addOverlay(popup);

  /* ğŸ”¥ Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¥Ù‚Ù„ÙŠÙ… */
  window.requestProvince = function(provinceName) {
    const message = `Je veux GLC ${provinceName}`;
    const whatsappURL = `https://wa.me/212633577988?text=${encodeURIComponent(message)}`;
    window.open(whatsappURL, "_blank");
  };
  
  /* ğŸ”¥ Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© */
  window.downloadFreeData = function(provinceName) {
    const link = downloadLinks[provinceName];
    if (link) {
      window.open(link, "_blank");
    }
  };

  function showPopup(feature, coord) {
    const name = getProvinceName(feature);
    let html = `<b>${name}</b><br>`;

    if (downloadLinks[name] && paidProvinces.includes(name)) {
      // Ù„Ù„Ø£Ù‚Ø§Ù„ÙŠÙ… Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
      html += `<a href="${downloadLinks[name]}" target="_blank">ğŸ“¥ TÃ©lÃ©charger</a>`;
    } else if (freeProvinces.includes(name)) {
      // ğŸ”¥ Ù„Ù„Ø£Ù‚Ø§Ù„ÙŠÙ… Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© - Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØ­Ù…ÙŠÙ„
      html += `âœ… DonnÃ©es gratuites<br>`;
      html += `<button class="download-btn" onclick="downloadFreeData('${name}')">ğŸ“¥ TÃ©lÃ©charger gratuitement</button>`;
    } else {
      // Ù„Ù„Ø£Ù‚Ø§Ù„ÙŠÙ… ØºÙŠØ± Ø§Ù„Ù…ØªÙˆÙØ±Ø©
      html += `â›” Les donnÃ©es ne sont pas prÃªtes.<br>`;
      html += `<button class="request-btn" onclick="requestProvince('${name}')">ğŸ“± Demander ces donnÃ©es</button>`;
    }

    popup.getElement().innerHTML = html;
    popup.setPosition(coord);
  }

  map.on("click", (evt) => {
    const f = map.forEachFeatureAtPixel(evt.pixel, ft => ft);
    if (f) showPopup(f, evt.coordinate);
    else popup.setPosition(undefined);
  });

  /* Ø¨Ø­Ø« */
  window.searchProvince = function() {
    const s = document.getElementById("searchBox").value.trim().toLowerCase();
    if (!s) return;

    let found = false;

    geojsonSource.getFeatures().forEach(ft => {
      const name = getProvinceName(ft).toLowerCase();
      if (name.includes(s)) {
        const ext = ft.getGeometry().getExtent();
        map.getView().fit(ext, { duration: 1000, padding: [50,50,50,50] });
        showPopup(ft, ol.extent.getCenter(ext));
        found = true;
      }
    });

    if (!found) alert("âš ï¸ Province introuvable");
  };

  /* ÙˆØ§ØªØ³Ø§Ø¨ */
  window.sendWhatsApp = function() {
    const name = document.getElementById("provinceInput").value.trim();
    let msg = "Bonjour, je suis intÃ©ressÃ© par les donnÃ©es LULC";
    if (name) msg += " pour la province de " + name;

    window.open(
      "https://wa.me/212633577988?text=" + encodeURIComponent(msg),
      "_blank"
    );
  };

});
</script>

</body>
</html>
