<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CartoMaroc Provinces</title>

  <!-- OpenLayers CSS & JS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.4.0/ol.css">
  <script src="https://cdn.jsdelivr.net/npm/ol@v7.4.0/dist/ol.js"></script>

  <style>
    /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    #app {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
    #header {
      flex-shrink: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
      padding: 12px 10px;
      font-size: clamp(14px, 4vw, 22px);
      font-weight: bold;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰: Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
    #content {
      position: relative;
      flex: 1;
      overflow: hidden;
    }

    /* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
    #map {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    /* Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© */
    #watermark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: clamp(18px, 5vw, 32px);
      font-weight: bold;
      color: rgba(102, 126, 234, 0.15);
      pointer-events: none;
      z-index: 1500;
      white-space: nowrap;
      text-shadow: 2px 2px 4px rgba(255,255,255,0.3);
    }

    /* Popup */
    .ol-popup {
      background: linear-gradient(135deg, #ffffff 0%, #f5f7fb 100%);
      padding: 14px 16px;
      border: 1px solid #e0e4ef;
      min-width: 200px;
      max-width: 90vw;
      z-index: 9999;
      font-size: 13px;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.18);
      color: #1f2933;
    }

    .ol-popup b {
      font-size: 14px;
      color: #111827;
    }

    .ol-popup a, .ol-popup button {
      display: inline-block;
      margin-top: 6px;
      padding: 6px 10px;
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: 6px;
      text-decoration: none;
      font-size: 12px;
      cursor: pointer;
      margin-right: 5px;
    }

    .ol-popup a:hover, .ol-popup button:hover {
      background: #1d4ed8;
    }

    .ol-popup .request-btn {
      background: #25D366;
    }

    .ol-popup .request-btn:hover {
      background: #128C7E;
    }

    .ol-popup .download-btn {
      background: #4CAF50;
    }

    .ol-popup .download-btn:hover {
      background: #388E3C;
    }

    /* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« */
    #searchContainer {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.96);
      padding: 6px 8px;
      border-radius: 999px;
      z-index: 2000;
      display: flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.18);
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    #searchBox {
      padding: 6px 12px;
      border: none;
      outline: none;
      border-radius: 999px;
      font-size: clamp(11px, 2.5vw, 13px);
      width: clamp(100px, 30vw, 160px);
      background: #f3f4f6;
      color: #111827;
    }

    #searchBox::placeholder {
      color: #9ca3af;
    }

    #searchBtn {
      padding: 6px 10px;
      border: none;
      background: #2563eb;
      color: white;
      border-radius: 999px;
      font-size: clamp(10px, 2vw, 12px);
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s, transform 0.1s;
    }

    #searchBtn:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }

    /* ğŸ”¥ Ø§Ù„Ù…ÙØªØ§Ø­: Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† Ù…ØªØ¬Ø§ÙˆØ¨ */
#legend {
  position: absolute;
  top: 400px;           /* Ø£Ø³ÙÙ„ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆÙ…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« */
  right: 10px;
  background: rgba(255, 255, 255, 0.96);
  padding: 10px 12px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.25);
  z-index: 3000;
  font-size: 11px;
  min-width: 135px;
  max-width: 45vw;
  border: 1px solid rgba(148, 163, 184, 0.7);
  backdrop-filter: blur(4px);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 6px;
}

.legend-item:last-child {
  margin-bottom: 0;
}

.legend-color {
  width: 16px;
  height: 16px;
  border: 1px solid #000;
  flex-shrink: 0;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
@media (max-width: 768px) {
  #header {
    padding: 10px 8px;
  }

  #searchContainer {
    top: 8px;
    right: 5px;
  }

  #legend {
    top: 60px;        /* Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù‡ÙŠØ¯Ø±/Ø§Ù„Ø¨Ø­Ø« */
    right: 5px;
    padding: 8px 10px;
    font-size: 10px;
    max-width: 60vw;  /* Ù„Ø§ ÙŠØºØ·ÙŠ Ù…Ø³Ø§Ø­Ø© ÙƒØ¨ÙŠØ±Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  }
}


    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .legend-item:last-child {
      margin-bottom: 0;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border: 1px solid #000;
      flex-shrink: 0;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    @media (max-width: 768px) {
      #header {
        padding: 10px 8px;
      }

      #searchContainer {
        top: 8px;
        right: 5px;
      }

      #legend {
        top: 55px;
        right: 5px;
        padding: 8px;
        font-size: 10px;
      }
    }
  </style>
</head>
<body>

  <div id="app">
    <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
    <header id="header">
      TÃ©lÃ©charger LULC GLC 30m (1985-2000-2010-2022)
    </header>

    <!-- Ø§Ù„Ø®Ø±ÙŠØ·Ø© + Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø·Ø§ÙÙŠØ© -->
    <main id="content">
      <div id="map">

        <div id="statsPanel" style="
  position:absolute;
  bottom:10px;
  left:10px;
  z-index:2500;
  background:rgba(255,255,255,0.96);
  padding:6px 10px;
  border-radius:8px;
  font-size:11px;
  box-shadow:0 2px 6px rgba(15,23,42,0.3);
  border:1px solid rgba(148,163,184,0.6);
">
  <div>ğŸŒ Nombre de visites (ce navigateur) : <span id="visitCount">0</span></div>
  <div>ğŸ“¥ Clics sur tÃ©lÃ©chargement (ce navigateur) : <span id="downloadCount">0</span></div>
</div>

        <!-- Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© -->
        <div id="watermark">@CartoMaroc</div>
      </div>

      <!-- Popup -->
      <div id="popup" class="ol-popup"></div>

      <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« -->
      <div id="searchContainer">
        <input id="searchBox" type="text" placeholder="ğŸ” Rechercher...">
        <button id="searchBtn" onclick="searchProvince()">Rechercher</button>
      </div>

      <!-- ğŸ”¥ Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† - Ø§Ù„Ø¢Ù† Ø®Ø§Ø±Ø¬ #map -->
      <div id="legend">
        <div class="legend-item">
          <div class="legend-color" style="background:rgba(76, 175, 80, 0.7);"></div>
          <span>Gratuit</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background:rgba(244, 67, 54, 0.7);"></div>
          <span>Payant 100dh</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background:rgba(162, 112, 163, 0.3);"></div>
          <span>Pas encore 100dh</span>
        </div>
        <div style="margin-top: 8px; font-size: 10px;">
          <span>Email: contact@cartomaroc.com</span>
        </div>
      </div>
    </main>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", function() {

    /* Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø£Ù‚Ø§Ù„ÙŠÙ… */
    const freeProvinces = ["Fahs-Anjra", "Deriouch", "Moulay Yacoub","Mediouna", "Fkih Ben Saleh",
                           "Youssoufia","Inezgane-Ait Melloul", "Tinghir", "Sidi Ifni","Tarfaya"];
    const paidProvinces = ["Marrakech", "Tanger-Asilah", "Skhirate-Temara"];

    const downloadLinks = {
      "Fahs-Anjra": "https://drive.google.com/file/d/1TQwmAVrqxXv3qhBsy3F9gMVfUu7DgBpV/view?usp=sharing",
      "Deriouch": "https://drive.google.com/file/d/1UKlqGjBq-TQIRH5lCd4z7a1R50LB1Kv3/view?usp=sharing",
      "Moulay Yacoub": "https://drive.google.com/file/d/1lWhSs81RbphgBGuMYLnaSYDjyz3zcyOD/view?usp=sharing",
       "Mediouna": "https://drive.google.com/file/d/1kxzfQFl45W1XZHv7hlU02Z8RJ6xssIru/view?usp=sharing",
      "Fkih Ben Saleh": "https://drive.google.com/file/d/1ib2b_JAimjRBMwEkAeFIPDx8MlBKWdM2/view?usp=sharing",
      "Youssoufia": "https://drive.google.com/file/d/1GIxxaukuPllYrLC1vCWvd0ROOFfqJj0O/view?usp=sharing", 
      "Sidi Ifni": "https://drive.google.com/file/d/1dQGv2TmGDEhjWEtd2ZSZRI0NEu2M5Fen/view?usp=sharing",
      "Inezgane-Ait Melloul": "https://drive.google.com/file/d/1CGdpvvHFfABh_W0dlEWFvG1NhXB87vqX/view?usp=sharing",
      "Tinghir": "https://drive.google.com/file/d/1S7GaO7M5b8IW-Ic-vbd23LlBQX0KB0c6/view?usp=sharing",
      "Tarfaya": "https://drive.google.com/file/d/1lrFzY5ECe_QD9U2NRAA_be1Lan-_1SLY/view?usp=sharing",

      
      "Marrakech": "https://drive.google.com/file/d/1DBtwIGzWY2sPVm2ZAli-kBWerNMstOPw/view",
      "Tanger-Asilah": "https://drive.google.com/file/d/1lnBOG5wqUAeG1EfuQNlenp6jHK1Pe4g_/view",
      "Skhirate-Temara": "https://drive.google.com/file/d/1Km67Ez0yEoy2zg1GKXGrjRmyRdoMKaZM/view",
    };

    const geojsonSource = new ol.source.Vector({
      url: "https://raw.githubusercontent.com/Ayoub-WebGis9/CartoMaroc/main/PROVINCE.geojson",
      format: new ol.format.GeoJSON()
    });

    function getProvinceName(feature) {
      const props = feature.getProperties();
      const possible = ["NOM-PROV","NOM_PROV","name","NAME","nom","Nom","Ø§Ù„Ø§Ù‚Ù„ÙŠÙ…","Ø§Ù„Ø¥Ù‚Ù„ÙŠÙ…"];
      for (let f of possible) if (props[f]) return props[f];
      return "Sans nom";
    }

    /* ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£Ù‚Ø§Ù„ÙŠÙ… */
    const geojsonLayer = new ol.layer.Vector({
      source: geojsonSource,
      style: function(feature) {
        const name = getProvinceName(feature);

        let fillColor = "rgba(162, 112, 163, 0.3)";
        if (freeProvinces.includes(name)) fillColor = "rgba(76, 175, 80, 0.7)";
        else if (paidProvinces.includes(name)) fillColor = "rgba(244, 67, 54, 0.7)";

        return new ol.style.Style({
          stroke: new ol.style.Stroke({ color: "black", width: 1.3 }),
          fill: new ol.style.Fill({ color: fillColor }),
          text: new ol.style.Text({
            text: name,
            font: "bold 12px Arial",
            fill: new ol.style.Fill({ color: "#000" }),
            stroke: new ol.style.Stroke({ color: "#fff", width: 2 })
          })
        });
      }
    });

    const map = new ol.Map({
      target: "map",
      layers: [
        new ol.layer.Tile({ source: new ol.source.OSM() }),
        geojsonLayer
      ],
      view: new ol.View({
        center: ol.proj.fromLonLat([-7.9, 31.6]),
        zoom: 6
      })
    });

    const popup = new ol.Overlay({
      element: document.getElementById("popup"),
      positioning: "bottom-center",
      offset: [0, -15]
    });
    map.addOverlay(popup);

    /* Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ */
    window.requestProvince = function(provinceName) {
      const message = `Salut CartoMaroc, Je veux Utilisation du sol GLC du ${provinceName}`;
      const whatsappURL = `https://wa.me/212633577988?text=${encodeURIComponent(message)}`;
      window.open(whatsappURL, "_blank");
    };

   
       /* Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© */
    window.downloadFreeData = function(provinceName) {
      const link = downloadLinks[provinceName];
      if (link) {
        incrementDownloadCounter();   // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.open(link, "_blank");
      }
    };


    function showPopup(feature, coord) {
      const name = getProvinceName(feature);
      let html = `<b>${name}</b><br>`;

      if (downloadLinks[name] && paidProvinces.includes(name)) {
        html += `<a href="${downloadLinks[name]}" target="_blank" onclick="incrementDownloadCounter()">ğŸ“¥ TÃ©lÃ©charger</a>`;

      } else if (freeProvinces.includes(name)) {
        html += `âœ… DonnÃ©es gratuites<br>`;
        html += `<button class="download-btn" onclick="downloadFreeData('${name}')">ğŸ“¥ TÃ©lÃ©charger gratuitement</button>`;
      } else {
        html += `â›” Les donnÃ©es ne sont pas prÃªtes.<br>`;
        html += `<button class="request-btn" onclick="requestProvince('${name}')">ğŸ“± Demander ces donnÃ©es</button>`;
      }

      popup.getElement().innerHTML = html;
      popup.setPosition(coord);
    }

    map.on("click", (evt) => {
      const f = map.forEachFeatureAtPixel(evt.pixel, ft => ft);
      if (f) showPopup(f, evt.coordinate);
      else popup.setPosition(undefined);
    });

    /* Ø¨Ø­Ø« */
    window.searchProvince = function() {
      const s = document.getElementById("searchBox").value.trim().toLowerCase();
      if (!s) return;

      let found = false;

      geojsonSource.getFeatures().forEach(ft => {
        const name = getProvinceName(ft).toLowerCase();
        if (name.includes(s)) {
          const ext = ft.getGeometry().getExtent();
          map.getView().fit(ext, { duration: 1000, padding: [50,50,50,50] });
          showPopup(ft, ol.extent.getCenter(ext));
          found = true;
        }
      });

      if (!found) alert("âš ï¸ Province introuvable");
    };

        // --- Compteur de visites (par navigateur) ---
    if (typeof Storage !== "undefined") {
      let visits = localStorage.getItem("cm_glc_visits");
      if (!visits) visits = 0;
      visits = Number(visits) + 1;
      localStorage.setItem("cm_glc_visits", visits);
      document.getElementById("visitCount").textContent = visits;
    }

    // --- Compteur de clics sur tÃ©lÃ©chargement (par navigateur) ---
    function incrementDownloadCounter() {
      if (typeof Storage !== "undefined") {
        let dls = localStorage.getItem("cm_glc_downloads");
        if (!dls) dls = 0;
        dls = Number(dls) + 1;
        localStorage.setItem("cm_glc_downloads", dls);
        document.getElementById("downloadCount").textContent = dls;
      }
    }


  });
  </script>

</body>
</html>



